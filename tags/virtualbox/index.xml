<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>virtualbox on namaraii.com</title>
    <link>https://namaraii.com/tags/virtualbox/</link>
    <description>Recent content in virtualbox on namaraii.com</description>
    <generator>Hugo -- gohugo.io</generator>
    <copyright>Copyright © 2008–2021, TAKEUCHI Hitoshi all rights reserved.</copyright>
    <lastBuildDate>Sat, 16 Dec 2017 14:33:33 +0900</lastBuildDate><atom:link href="https://namaraii.com/tags/virtualbox/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>VagrantとVirtualBoxでMac上に開発環境を作るメモ(CentOS7/Ruby 2.4.3)</title>
      <link>https://namaraii.com/post/2017/20171216_vagrant-virtualbox/</link>
      <pubDate>Sat, 16 Dec 2017 14:33:33 +0900</pubDate>
      
      <guid>https://namaraii.com/post/2017/20171216_vagrant-virtualbox/</guid>
      <description>
        
          &lt;p&gt;MacでVagrantとVirtualBoxを使って開発環境を作るメモです。&lt;/p&gt;
&lt;h2 id=&#34;インストール&#34;&gt;インストール&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/h5HGVd&#34;&gt;Download - Vagrant by HashiCorp&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/l3wrf&#34;&gt;Downloads – Oracle VM VirtualBox&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;今回はCentOS7のBOXを使用したが、他のBOXは以下から探せる。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/qqX7GZ&#34;&gt;Discover Vagrant Boxes - Vagrant Cloud&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/GYN3i&#34;&gt;A list of base boxes for Vagrant - Vagrantbox.es&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;vagrantの環境設定&#34;&gt;Vagrantの環境設定&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; your_project_directory
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;$ vagrant init
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Vagrantfileを作成する。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# -*- mode: ruby -*-&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# vi: set ft=ruby :&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;Vagrant&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;configure&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;box&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;centos/7&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;network&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;forwarded_port&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;ss&#34;&gt;guest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;ss&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3000&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;provider&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;virtualbox&amp;#34;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vb&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;vb&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;memory&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2048&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;provision&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;shell&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;ss&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;provision.sh&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;ss&#34;&gt;privileged&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kp&#34;&gt;false&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Chef、PuppetやAnsibleなどのプロビジョニング・ツールとも連携できるが、とりまシェルスクリプトで。provision.shを作成する。&lt;/p&gt;
&lt;p&gt;Railsを使うためRuby2.4.3とNode.js、PostgreSQL、Redisをインストール。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;sudo yum -y update
&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;## Developer Toolset 7&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;## https://www.softwarecollections.org/en/scls/rhscl/devtoolset-7/&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;sudo yum -y install centos-release-scl
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt;sudo yum-config-manager --enable rhel-server-rhscl-7-rpms
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;sudo yum -y install devtoolset-7
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;## Another packages&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt;sudo yum -y install git zlib-devel openssl-devel readline-devel libyaml-devel sqlite-devel libxml2-devel libxslt-devel libcurl-devel libffi-devel
&lt;span class=&#34;ln&#34;&gt;11&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;## Ruby 2.4.3&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;13&lt;/span&gt;git clone https://github.com/rbenv/rbenv.git ~/.rbenv
&lt;span class=&#34;ln&#34;&gt;14&lt;/span&gt;git clone https://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build
&lt;span class=&#34;ln&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; ~/.rbenv &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; src/configure &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; make -C src
&lt;span class=&#34;ln&#34;&gt;16&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;export PATH=&amp;#34;$HOME/.rbenv/bin:$PATH&amp;#34;&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; ~/.bash_profile
&lt;span class=&#34;ln&#34;&gt;17&lt;/span&gt;~/.rbenv/bin/rbenv init
&lt;span class=&#34;ln&#34;&gt;18&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;eval &amp;#34;$(rbenv init -)&amp;#34;&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; ~/.bash_profile
&lt;span class=&#34;ln&#34;&gt;19&lt;/span&gt;. ~/.bash_profile
&lt;span class=&#34;ln&#34;&gt;20&lt;/span&gt;rbenv install 2.4.3
&lt;span class=&#34;ln&#34;&gt;21&lt;/span&gt;rbenv global 2.4.3
&lt;span class=&#34;ln&#34;&gt;22&lt;/span&gt;rbenv rehash
&lt;span class=&#34;ln&#34;&gt;23&lt;/span&gt;gem install bundler
&lt;span class=&#34;ln&#34;&gt;24&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;## Node.js&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;26&lt;/span&gt;curl -sL https://rpm.nodesource.com/setup_6.x &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; sudo bash -
&lt;span class=&#34;ln&#34;&gt;27&lt;/span&gt;sudo yum install -y nodejs
&lt;span class=&#34;ln&#34;&gt;28&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;29&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;## PostgreSQL&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;30&lt;/span&gt;sudo yum -y install postgresql-server postgresql-devel
&lt;span class=&#34;ln&#34;&gt;31&lt;/span&gt;sudo postgresql-setup initdb
&lt;span class=&#34;ln&#34;&gt;32&lt;/span&gt;sudo service postgresql start
&lt;span class=&#34;ln&#34;&gt;33&lt;/span&gt;sudo systemctl start postgresql.service
&lt;span class=&#34;ln&#34;&gt;34&lt;/span&gt;sudo systemctl &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; postgresql.service
&lt;span class=&#34;ln&#34;&gt;35&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;36&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;## Redis&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;37&lt;/span&gt;sudo yum -y install epel-release
&lt;span class=&#34;ln&#34;&gt;38&lt;/span&gt;sudo yum install -y wget
&lt;span class=&#34;ln&#34;&gt;39&lt;/span&gt;sudo rpm -Uvh remi-release-7*.rpm
&lt;span class=&#34;ln&#34;&gt;40&lt;/span&gt;sudo yum --enablerepo&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;remi,remi-test,epel install -y redis
&lt;span class=&#34;ln&#34;&gt;41&lt;/span&gt;sudo systemctl start redis.service
&lt;span class=&#34;ln&#34;&gt;42&lt;/span&gt;sudo systemctl &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; redis.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;provision.shを作成したら、コマンドラインからvagrantを起動する。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ vagrant up
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;インストールが終わるまでしばし待ち、sshで接続する。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ vagrant ssh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;vagrantのコマンド&#34;&gt;Vagrantのコマンド&lt;/h2&gt;
&lt;h3 id=&#34;リロード&#34;&gt;リロード&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ vagrant reload
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;シャットダウン&#34;&gt;シャットダウン&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ vagrant halt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;サスペンド&#34;&gt;サスペンド&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ vagrant &lt;span class=&#34;nb&#34;&gt;suspend&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;vmの削除&#34;&gt;VMの削除&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ vagrant destroy
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ホストosとのファイル共有&#34;&gt;ホストOSとのファイル共有&lt;/h2&gt;
&lt;p&gt;デフォルトではVagrantfileのディレクトリがホストOSの/vargrantに同期される（ホスト→ゲストの一方通行）。ただしrsyncのため(90秒インターバル？）ホスト側でvagrant rsync-autoを起動しておく必要がある。&lt;/p&gt;
&lt;p&gt;同期のタイプとしてSMB、NFS、VirtualBOX、rsyncがあるが、パフォーマンスや信頼性の点でrsyncが良さそう。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/oMsvYQ&#34;&gt;【Vagrantドキュメント意訳】11.同期フォルダ - Qiita&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;scpを使う&#34;&gt;scpを使う&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ vagrant ssh-config &amp;gt; ssh.config
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;$ scp -F ssh.config vagrant@default:/var/lib/redmine/erd.pdf .
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;参考リンク&#34;&gt;参考リンク&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;CentOSのコレクションを探す &lt;a href=&#34;https://goo.gl/MSdgbD&#34;&gt;Directory — Software Collections&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://goo.gl/z7WLKo&#34;&gt;Vagrant + VirtualBoxでつくるRails 5の環境構築 - Qiita&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
        
      </description>
    </item>
    
  </channel>
</rss>
