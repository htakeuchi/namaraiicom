<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>rails on namaraii.com</title>
    <link>https://namaraii.com/tags/rails/</link>
    <description>Recent content in rails on namaraii.com</description>
    <generator>Hugo -- gohugo.io</generator>
    <copyright>Copyright © 2008–2021, TAKEUCHI Hitoshi all rights reserved.</copyright>
    <lastBuildDate>Fri, 05 Sep 2008 00:00:00 +0000</lastBuildDate><atom:link href="https://namaraii.com/tags/rails/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>RailsからSalesforceのDBへ簡単にアクセスできるActiveSalesforceを味見してハマったこと</title>
      <link>https://namaraii.com/post/2008/20080905_railssalesforcedbactivesalesforcedf9770a3cde0/</link>
      <pubDate>Fri, 05 Sep 2008 00:00:00 +0000</pubDate>
      
      <guid>https://namaraii.com/post/2008/20080905_railssalesforcedbactivesalesforcedf9770a3cde0/</guid>
      <description>
        
          &lt;p&gt;&lt;a href=&#34;http://activesfdc.rubyforge.org/&#34;&gt;ActiveSalesforce&lt;/a&gt;というSalesforceのデータベースをActiveRecord経由でアクセスできるアダプタを触ってみました。ちょっとハマった部分があるのでメモしておきます。&lt;/p&gt;
&lt;h4 id=&#34;インストールと設定&#34;&gt;インストールと設定&lt;/h4&gt;
&lt;p&gt;私が試した環境はRails 2.1.0です。Rails 2.xだと、&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ gem install activerecord-activesalesforce-adapter
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;だけでOK。Rails
1.xだとインストールと設定の手順が違いますので&lt;a href=&#34;http://activesfdc.rubyforge.org/&#34;&gt;こちら&lt;/a&gt;を参照してください。&lt;/p&gt;
&lt;p&gt;インストール後、すぐに下にあるようなコードを書いて動かしてみたのですが、&lt;a href=&#34;http://rubyforge.org/tracker/?func=detail&amp;amp;group_id=1201&amp;amp;aid=19960&amp;amp;atid=4729&#34;&gt;RubyForge: ActiveSalesforce: トラッカー詳細: 19960 defining belongs_to with :dependent =&amp;gt; :nullify is broken in edge rails &amp;gt; r8675&lt;/a&gt;と同じ事象が発生し動作しませんでした。このチケットにあるパッチをあてたところ、うまく動くように。&lt;/p&gt;
&lt;p&gt;次にRailsでプロジェクトを作成し、config/database.ymlを次のように書き換えます。&lt;br&gt;
[sourcecode language=”ruby”]&lt;br&gt;
development:&lt;br&gt;
 adapter: activesalesforce&lt;br&gt;
 url:
&lt;a href=&#34;https://www.salesforce.com/services/Soap/u/8.0&#34;&gt;https://www.salesforce.com/services/Soap/u/8.0&lt;/a&gt;&lt;br&gt;
 username: Salesforceのアカウント&lt;br&gt;
 password: Salesforceのパスワード|セキュリティトークン&lt;br&gt;
[/sourcecode]&lt;br&gt;
ActiveSalesforceのドキュメントではパスワードだけを指定するように書かれていますが、今のSalesforceでは(ネットワークを信頼済みに設定しない限り）API経由でアクセスする際はパスワードに続けてセキュリティートークンを指定する必要があります。&lt;/p&gt;
&lt;p&gt;セキュリティトークンはSalesforceにログインし、[設定] |
[私の個人情報] | [セキュリティトークンのリセット] から参照できます。&lt;/p&gt;
&lt;p&gt;尚、上記のconfig/database.ymlのサンプルでは、パスワードとセキュリティトークンの間に|がありますが、これは可読性のために入れてあります。&lt;/p&gt;
&lt;p&gt;実際に指定するときはパスワードに続けてセキュリティトークンを指定してください。&lt;/p&gt;
&lt;h4 id=&#34;salesforceのデータにアクセスする&#34;&gt;Salesforceのデータにアクセスする&lt;/h4&gt;
&lt;p&gt;あとはRailsの世界です。ここではSalesforceの取引先(account)の一覧を出力してみます。accountのコントローラとビューを作成します。コントローラの方はこんな感じ。&lt;br&gt;
[sourcecode language=”ruby”]&lt;br&gt;
def index&lt;br&gt;
 @accounts = Account.find(:all)&lt;br&gt;
 respond_to do |format|&lt;br&gt;
 format.html # index.html.erb&lt;br&gt;
 format.xml { render :xml =&amp;amp;gt; @accounts }&lt;br&gt;
 end&lt;br&gt;
end&lt;br&gt;
[/sourcecode]&lt;br&gt;
ビュー(index.html.erb)はこんな感じ。&lt;br&gt;
[sourcecode language=”html”]&lt;br&gt;
&amp;amp;lt;h1&amp;amp;gt;取引先一覧&amp;amp;lt;/h1&amp;amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;amp;lt;table&amp;amp;gt;&lt;br&gt;
 &amp;amp;lt;tr&amp;amp;gt;&lt;br&gt;
 &amp;amp;lt;th&amp;amp;gt;取引先番号&amp;amp;lt;/th&amp;amp;gt;&lt;br&gt;
 &amp;amp;lt;th&amp;amp;gt;取引先名&amp;amp;lt;/th&amp;amp;gt;&lt;br&gt;
 &amp;amp;lt;th&amp;amp;gt;住所(請求先)&amp;amp;lt;/th&amp;amp;gt;&lt;br&gt;
 &amp;amp;lt;th&amp;amp;gt;電話&amp;amp;lt;/th&amp;amp;gt;&lt;br&gt;
 &amp;amp;lt;th&amp;amp;gt;Fax&amp;amp;lt;/th&amp;amp;gt; &lt;br&gt;
 &amp;amp;lt;th&amp;amp;gt;説明&amp;amp;lt;/th&amp;amp;gt; &lt;br&gt;
 &amp;amp;lt;/tr&amp;amp;gt;&lt;/p&gt;
&lt;p&gt;&amp;amp;lt;% for account in @accounts %&amp;amp;gt;&lt;br&gt;
 &amp;amp;lt;tr&amp;amp;gt;&lt;br&gt;
 &amp;amp;lt;td&amp;amp;gt;&amp;amp;lt;%=h account.account_number
%&amp;amp;gt;&amp;amp;lt;/td&amp;amp;gt;&lt;br&gt;
 &amp;amp;lt;td&amp;amp;gt;&amp;amp;lt;%=h account.name
%&amp;amp;gt;&amp;amp;lt;/td&amp;amp;gt;&lt;br&gt;
 &amp;amp;lt;td&amp;amp;gt;&lt;br&gt;
 &amp;amp;lt;%=h account.billing_postal_code %&amp;amp;gt;&lt;br&gt;
 &amp;amp;lt;%=h account.billing_state %&amp;amp;gt;&lt;br&gt;
 &amp;amp;lt;%=h account.billing_city %&amp;amp;gt;&lt;br&gt;
 &amp;amp;lt;%=h account.billing_street %&amp;amp;gt;&lt;br&gt;
 &amp;amp;lt;/td&amp;amp;gt;&lt;br&gt;
 &amp;amp;lt;td&amp;amp;gt;&amp;amp;lt;%=h account.phone
%&amp;amp;gt;&amp;amp;lt;/td&amp;amp;gt;&lt;br&gt;
 &amp;amp;lt;td&amp;amp;gt;&amp;amp;lt;%=h account.fax
%&amp;amp;gt;&amp;amp;lt;/td&amp;amp;gt;&lt;br&gt;
 &amp;amp;lt;td&amp;amp;gt;&amp;amp;lt;%=h account.description
%&amp;amp;gt;&amp;amp;lt;/td&amp;amp;gt;&lt;br&gt;
 &amp;amp;lt;/tr&amp;amp;gt;&lt;br&gt;
&amp;amp;lt;% end %&amp;amp;gt;&lt;br&gt;
&amp;amp;lt;/table&amp;amp;gt;&lt;br&gt;
[/sourcecode]&lt;br&gt;
http://localhost:3000/accountsへアクセスしたらこんな感じに。&lt;/p&gt;
&lt;p&gt;うん、普通にRailsアプリですね。とは言え、Salesforceのスキーマを知らないと何もできません。&lt;/p&gt;
&lt;p&gt;Salesforceのスキーマは&lt;a href=&#34;http://www.salesforce.com/us/developer/docs/api/index.htm&#34;&gt;Force.com Web Services API Developer’s Guide&lt;/a&gt;のReference — Standard
Objectsから参照可能です。&lt;/p&gt;
&lt;p&gt;なお、RailsからSalesforceのデータへアクセスする場合、メンバ名を以下のように読み替える必要がありますのでご注意。&lt;/p&gt;
&lt;p&gt;Filed
Name(ドキュメントの表記)Railsのメンバ名BillingPostalCodebilling_postal_code&lt;/p&gt;
&lt;p&gt;Salesforceを導入するような企業は既に基幹システムを持っているケースも多いと思います。&lt;/p&gt;
&lt;p&gt;その場合、Force.com
APIを使ってAjaxリクエストでデータを取得したり、バッチを開発したりして既存システムとSalesforceのデータ連係を実現する方法が主流だと思いますが、ActiveSalesforce
+
Railsという構成で、Railsの生産性の高さを生かしたSalesforce連携システム開発というのも可能性を感じます。&lt;/p&gt;
&lt;p&gt;す。&lt;/p&gt;

        
      </description>
    </item>
    
  </channel>
</rss>
